<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Pong Game with Gamepad & Mouse</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { background: #111; display: flex; justify-content: center; align-items: center; height: 100vh; }
    canvas { background: #000; border: 3px solid white; }
  </style>
</head>
<body>
  <canvas id="pong" width="800" height="400"></canvas>

  <script>
    const canvas = document.getElementById("pong");
    const ctx = canvas.getContext("2d");

    const paddle = { x: 360, y: 380, width: 80, height: 10, speed: 6 };
    const ball = { x: 400, y: 200, radius: 8, dx: 4, dy: 4 };
    let gameOver = false;
    let ballStartDelay = 0;
    let gameStarted = false;

    function drawPaddle() {
      ctx.fillStyle = "white";
      ctx.fillRect(paddle.x, paddle.y, paddle.width, paddle.height);
    }

    function drawBall() {
      ctx.beginPath();
      ctx.arc(ball.x, ball.y, ball.radius, 0, Math.PI * 2);
      ctx.fillStyle = "white";
      ctx.fill();
      ctx.closePath();
    }

    function drawStartScreen() {
      ctx.fillStyle = "white";
      ctx.font = "28px Arial";
      ctx.fillText("Press Enter or Start to Begin", 220, 200);
    }

    function drawGameOver() {
      ctx.fillStyle = "red";
      ctx.font = "30px Arial";
      ctx.fillText("Game Over! Press Enter or Start", 180, 200);
    }

    function draw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      drawPaddle();
      if (gameStarted) drawBall();
      if (!gameStarted && !gameOver) drawStartScreen();
      if (gameOver) drawGameOver();
    }

    function update() {
      if (!gameStarted || gameOver || ballStartDelay > 0) {
        if (ballStartDelay > 0) ballStartDelay--;
        return;
      }

      // Move ball
      ball.x += ball.dx;
      ball.y += ball.dy;

      // Wall collision
      if (ball.x < ball.radius || ball.x > canvas.width - ball.radius) ball.dx *= -1;
      if (ball.y < ball.radius) ball.dy *= -1;

      // Paddle collision
      if (ball.y + ball.radius >= paddle.y &&
          ball.x >= paddle.x && ball.x <= paddle.x + paddle.width) {
        ball.dy *= -1;
      }

      // Missed ball
      if (ball.y > canvas.height) {
        gameOver = true;
        gameStarted = false;
      }
    }

    function clampPaddle() {
      if (paddle.x < 0) paddle.x = 0;
      if (paddle.x + paddle.width > canvas.width) paddle.x = canvas.width - paddle.width;
    }

    // Keyboard controls
    document.addEventListener("keydown", e => {
      if (e.key === "ArrowLeft") paddle.x -= paddle.speed;
      if (e.key === "ArrowRight") paddle.x += paddle.speed;
      if (e.key === "Enter") {
        if (!gameStarted && !gameOver) startGame();
        else if (gameOver) resetGame();
      }
      clampPaddle();
    });

    // Mouse control
    canvas.addEventListener("mousemove", e => {
      const rect = canvas.getBoundingClientRect();
      const mouseX = e.clientX - rect.left;
      paddle.x = mouseX - paddle.width / 2;
      clampPaddle();
    });

    // Gamepad input (movement + Start = Button 8 for your controller)
    function gamepadControls() {
      const gamepads = navigator.getGamepads();
      let gp = null;

      // Use first connected gamepad
      for (let i = 0; i < gamepads.length; i++) {
        if (gamepads[i] && gamepads[i].connected) {
          gp = gamepads[i];
          break;
        }
      }

      if (gp) {
        // Start button = button 8 for Twin USB Joystick
        if (gp.buttons[8]?.pressed) {
          if (!gameStarted && !gameOver) startGame();
          else if (gameOver) resetGame();
        }

        // Left stick axis X (0 or fallback 2)
        const axisX = Math.abs(gp.axes[0]) > 0.1 ? gp.axes[0] : (Math.abs(gp.axes[2]) > 0.1 ? gp.axes[2] : 0);
        if (Math.abs(axisX) > 0.1) {
          paddle.x += axisX * paddle.speed;
        }

        // D-pad fallback
        if (gp.buttons[14]?.pressed) paddle.x -= paddle.speed;
        if (gp.buttons[15]?.pressed) paddle.x += paddle.speed;

        clampPaddle();
      }

      requestAnimationFrame(gamepadControls);
    }

    function startGame() {
      gameStarted = true;
      ballStartDelay = 60;
    }

    function resetGame() {
      ball.x = 400;
      ball.y = 200;
      ball.dx = 5;
      ball.dy = 5;
      paddle.x = 360;
      gameStarted = false;
      gameOver = false;
      ballStartDelay = 0;
    }

    function loop() {
      update();
      draw();
      requestAnimationFrame(loop);
    }

    requestAnimationFrame(gamepadControls);
    loop();
  </script>
</body>
</html>
